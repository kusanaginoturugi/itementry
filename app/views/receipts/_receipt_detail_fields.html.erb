<div class="card shadow-sm mb-2" data-receipt-form-target="detail">
  <div class="card-body">
    <div class="row gy-2 align-items-end">
      <div class="col-md-2">
        <%= f.label :item_code, "道具コード", class: "form-label" %>
        <%= text_field_tag :item_code_display, f.object.item_code.presence || f.object.item&.item_code, class: "form-control", required: true, name: "", data: { receipt_form_target: "itemCodeField", action: "input->receipt-form#handleCodeInput change->receipt-form#loadItemName" } %>
        <%= f.hidden_field :item_code, data: { receipt_form_target: "itemCodeHidden" } %>
        <%= f.hidden_field :item_id, data: { receipt_form_target: "itemIdField" } %>
        <div class="small border rounded mt-2 suggestions-box" data-receipt-form-target="suggestions" style="max-height: 200px; overflow-y: auto;"></div>
      </div>
      <div class="col-md-3">
        <%= f.label :item_name, "道具名", class: "form-label" %>
        <% display_name = f.object.item_name.presence || f.object.item&.name || "-" %>
        <p class="form-control-plaintext mb-0" data-receipt-form-target="itemName"><%= display_name %></p>
        <%= f.hidden_field :item_name, data: { receipt_form_target: "itemNameField" } %>
      </div>
      <div class="col-md-2">
        <%= f.label :count, "個数", class: "form-label" %>
        <%= f.number_field :count, class: "form-control", min: 0, step: 1, required: true, data: { action: "input->receipt-form#recalculate" } %>
      </div>
      <div class="col-md-2">
        <%= f.label :value, "単価", class: "form-label" %>
        <% variable = f.object.item&.is_variable_value %>
        <%= f.number_field :value,
          class: "form-control",
          min: 0,
          step: 1,
          required: true,
          readonly: variable == false,
          tabindex: variable == false ? -1 : nil,
          data: {
            receipt_form_target: "valueField",
            action: "input->receipt-form#recalculate",
            variable_value: variable
          } %>
      </div>
      <div class="col-md-2">
        <%= f.label :sum_value, "小計", class: "form-label" %>
        <p class="form-control-plaintext mb-0" data-receipt-form-target="sumDisplay"><%= number_with_delimiter(f.object.sum_value || 0) %></p>
        <%= f.hidden_field :sum_value, data: { receipt_form_target: "sumField" } %>
      </div>
      <div class="col-md-1 d-flex gap-1 justify-content-end">
        <%= link_to "追加", "#", class: "btn btn-outline-primary btn-sm", data: { action: "click->receipt-form#addDetail keydown.enter->receipt-form#addDetail" } %>
        <%= link_to "削除", "#", class: "btn btn-outline-danger btn-sm", data: { action: "receipt-form#removeDetail" } %>
      </div>
    </div>
    <%= f.hidden_field :_destroy, value: "0", data: { receipt_form_target: "destroyField" } %>
  </div>
</div>
